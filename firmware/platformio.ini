[platformio]
default_envs = teensy40_main

; --- Main project environment ---
[env:teensy40_main]
platform = teensy
board = teensy40
framework = arduino
upload_protocol = teensy-cli
monitor_speed = 115200

; Include src and include folders, exclude tests
build_src_filter =
    +<src/main.cpp>          ; explicitly include main.cpp
    +<src/**.cpp>            ; include other sources
    +<include/**.h>          ; include all headers
    -<test/>                 ; exclude tests explicitly
    -<.pio/libdeps/>         ; exclude PlatformIO generated folders
    -<.pio/build/>

lib_extra_dirs = lib

; Libraries (add the necessary libraries for project)
lib_deps =
    FastLED                             ; For addressable LEDs
    Bounce2                             ; For debouncing buttons
    MIDI                                ; For MIDI input/output handling
    lathoub/USB-MIDI@^1.1.3             ; USB MIDI
    adafruit/Adafruit SSD1306 @ ^2.5.7  ; For display
    adafruit/Adafruit GFX Library @ ^1.11.3
    TimerOne                            ; Timer interrupts
    EEPROM                              ; Memory/presets management

; Custom build flags
build_flags =
    -D USB_MIDI_SERIAL                  ; Enable MIDI over USB and debugging
    -D FASTLED_ALLOW_INTERRUPTS=0       ; Optimize Teensy performance, adjust for production

; --- Environment for mainTEST.cpp (component testing) ---
[env:teensy40_mainTEST]
extends = env:teensy40_main
build_src_filter =
    +<test/mainTEST.cpp>                ; Include mainTEST.cpp for unit testing
    +<src/>
    +<include/>
    -<src/main.cpp>                     ; Exclude main application file

; --- Environment for BiquadFilter unit tests ---
[env:teensy40_biquadfilter_test]
extends = env:teensy40_main
build_src_filter =
    +<test/test_biquadfilter.cpp>       ; Include BiquadFilter unit test
    +<src/>
    +<include/>
    -<src/main.cpp>                     ; Exclude main application file

; --- Environment for unified hardware test ---
[env:teensy40_unified_test]
extends = env:teensy40_main
build_src_filter =
    +<test/unified.cpp>                 ; Include unified hardware test
    +<src/>
    +<include/>
    -<src/main.cpp>                     ; Exclude main application file